---
layout: post
author: "Yan"
catalog: true
subtitle: "성능 개선을 위해 튜닝을 하며"
header-img: "img/header/sql.jpg"
title: "Oracle - index, explain plan"
date: 2023-08-20 11:40:08 +0000
categories:
  - SQL
tags:
  - SQL
  - DB
  - 데이터
comments: true
---

최근 속도 개선 이슈 튜너와 상의 후 몇 가지 쿼리의 explain plan을 확인하고 인덱스를 추가할 일이 있었다.  
비교적 많은 테이블들을 join해야하는 조회 서비스에서 table full search가 발생하고 있었기 때문이다.  


## 실행계획

- 실행계획 : 사용자가 SQL을 실행하여 데이터를 추출하려고 할 때 옵티마이저가 수립하는 작업 절차다.
- 옵티마이저는 DBMS의 핵심 엔진으로, 가장 효율적인 방법으로 SQL을 수행할 최적의 처리 경로를 생성해준다.  
- 컴퓨터 : CPU = DBMS : 옵티마이저  
- SQL을 작성하고 실행하면 즉시 실행되는 것이 아니라, 옵티마이저가 여러가지 실행 계획을 세운 뒤, 시스템 통계 정보를 활용하여 각 실행 계획의 예상 비용을 산정하고, 최고의 효율을 가지고 있는 실행계획에 따라 쿼리를 수행하게 된다.

### EXPLAIN PLAN

- 실행계획을 확인하는 방법에는 `EXPLAIN PLAN`, `AUTOTRACE`, `SQL TRACE`가 있다.

#### 예제

```sql
EXPLAIN PLAN -- EXPLANIN  PLAN 선언부
SET STATEMENT_ID = 'PLAN1' INTO PLAN_TABLE -- SQL에 PLAN1이라는 ID 부여
FOR
SELECT * FROM REGIONS A --SQL 입력부
LEFT OUTER JOIN COUNTRIES B ON A.REGION_ID = B.REGION_ID;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY -- PLAN_TABLE에 저장된 실행계획 조회
('PLAN_TABLE','PLAN1','ALL'));
```

1. EXPLAIN PLAN의 사용법은 SELECT문 앞에 실행 계획을 저장하라고 명시
2. 실행할 SQL에 임의의 ID를 부여한 다음 FOR를 쓰기
3. 쿼리문의 실행계획을 PLAN_TABLE에 저장한 후 직접 조회

단, EXPLAIN PLAN은 한번에 하나의 쿼리문의 실행계획만을 확인할 수 있고 그 실행계획을 또 확인하기 위해 별도의 SELECT문을 작성해야 하는 번거로움과 데이터를 읽지 않기 때문에 소요시간을 추정한다거나 데이터 관련 I/O정보를 확인할 수 없다


###### reference

> [[DB] 데이터베이스 옵티마이저(Optimizer)에 대하여](https://coding-factory.tistory.com/743)    
> [[Oracle] 오라클 실행 계획 확인하기 (EXPLAIN PLAN, SET AUTORACE, SQL TRACE)](https://coding-factory.tistory.com/745)